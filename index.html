<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>NEON TITANS</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Courier New', sans-serif; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* Sınıf Seçimi */
        #class-select {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 20px; border: 2px solid #00ff00;
            display: flex; gap: 20px; pointer-events: auto; text-align: center;
        }
        .c-btn { 
            padding: 20px; cursor: pointer; border: 1px solid #555; color: white; transition: 0.3s; 
            width: 100px;
        }
        .c-btn:hover { background: #222; border-color: #fff; }
        .c-title { font-weight: bold; display: block; margin-bottom: 10px; font-size: 18px; }
        
        /* HUD */
        #hud { position: absolute; bottom: 20px; left: 20px; color: white; }
        #hp-bar { width: 200px; height: 20px; background: #333; border: 1px solid #fff; margin-top: 5px; }
        #hp-fill { width: 100%; height: 100%; background: #0f0; transition: width 0.2s; }
        
        /* Skor Tablosu */
        #leaderboard { position: absolute; top: 20px; right: 20px; color: rgba(255,255,255,0.8); text-align: right; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <div id="leaderboard">Liderlik Yükleniyor...</div>
        <div id="hud">
            <div id="info">Sınıf: -- | Skor: 0</div>
            <div id="hp-bar"><div id="hp-fill"></div></div>
            <small>WASD: Hareket | SHIFT: Dash | TIK: Ateş</small>
        </div>
        
        <div id="class-select">
            <div class="c-btn" onclick="selectClass('tank')">
                <span class="c-title" style="color:#0099ff">TANK</span>
                Yüksek Can<br>Hızlı Ateş
            </div>
            <div class="c-btn" onclick="selectClass('sniper')">
                <span class="c-title" style="color:#00ff00">SNIPER</span>
                Uzun Menzil<br>Tek Atış
            </div>
            <div class="c-btn" onclick="selectClass('shotgun')">
                <span class="c-title" style="color:#ff0055">SHOTGUN</span>
                Yakın Mesafe<br>Saçılma
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // --- SENİN İSTEDİĞİN BAĞLANTI LİNKİ BURADA KULLANILIYOR ---
        const socket = io('https://oyun-75fx.onrender.com');

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Ekranı tam boyut yap
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Değişkenler
        let me = null;
        let players = {};
        let bullets = [];
        let particles = [];
        let camX = 0, camY = 0;
        let shake = 0;

        // Girdiler
        const keys = { w:false, a:false, s:false, d:false, shift:false };
        const mouse = { x:0, y:0, down:false };

        // Event Listeners
        window.addEventListener('keydown', e => { if(keys.hasOwnProperty(e.key.toLowerCase())) keys[e.key.toLowerCase()] = true; });
        window.addEventListener('keyup', e => { if(keys.hasOwnProperty(e.key.toLowerCase())) keys[e.key.toLowerCase()] = false; });
        window.addEventListener('mousedown', () => mouse.down = true);
        window.addEventListener('mouseup', () => mouse.down = false);
        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        // Sınıf Seçimi
        function selectClass(type) {
            socket.emit('selectClass', type);
            document.getElementById('class-select').style.display = 'none';
        }

        // Sunucu Dinleyicileri
        socket.on('state', (state) => {
            players = state.players;
            bullets = state.bullets;
            me = players[socket.id];
            updateHUD();
        });

        socket.on('hitEffect', (data) => {
            createExplosion(data.x, data.y, data.color);
            if(me) {
                const dist = Math.hypot(data.x - me.x, data.y - me.y);
                if(dist < 400) shake = 10; // Yakında patlama olursa ekran sallar
            }
        });

        // Input Döngüsü
        setInterval(() => {
            if(!me) return;
            // Mouse açısını kameraya göre hesapla
            const angle = Math.atan2(mouse.y - (me.y - camY), mouse.x - (me.x - camX));
            socket.emit('input', { keys, mouse: { down: mouse.down }, angle });
        }, 1000/60);

        // --- GÖRSEL MOTOR ---
        function draw() {
            // Arkaplan Temizle
            ctx.fillStyle = '#050505';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if(me) {
                // Kamerayı oyuncuya odakla (Smooth lerp)
                let targetCamX = me.x - canvas.width / 2;
                let targetCamY = me.y - canvas.height / 2;
                camX += (targetCamX - camX) * 0.1;
                camY += (targetCamY - camY) * 0.1;
            }

            // Ekran Sarsıntısı
            let shakeX = 0, shakeY = 0;
            if(shake > 0) {
                shakeX = (Math.random() - 0.5) * shake;
                shakeY = (Math.random() - 0.5) * shake;
                shake *= 0.9;
            }

            ctx.save();
            ctx.translate(-camX + shakeX, -camY + shakeY);

            // Izgara (Grid) Çizimi
            drawGrid();

            // Oyuncular
            for(let id in players) {
                let p = players[id];
                if(p.isDead) continue;

                // Gövde
                ctx.save();
                ctx.translate(p.x, p.y);
                
                // Neon Efekti
                ctx.shadowBlur = 15;
                ctx.shadowColor = p.color;
                ctx.fillStyle = '#000';
                ctx.strokeStyle = p.color;
                ctx.lineWidth = 4;

                ctx.beginPath();
                ctx.arc(0, 0, 20, 0, Math.PI*2);
                ctx.fill();
                ctx.stroke();

                // İsim
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(p.classType.toUpperCase(), 0, -30);

                // Can Barı (Oyuncu üstü)
                ctx.fillStyle = 'red';
                ctx.fillRect(-15, -25, 30, 4);
                ctx.fillStyle = '#0f0';
                ctx.fillRect(-15, -25, 30 * (p.hp / 100), 4); // Basit oran

                ctx.restore();
            }

            // Mermiler
            bullets.forEach(b => {
                ctx.fillStyle = '#fff';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#fff';
                ctx.beginPath();
                ctx.arc(b.x, b.y, 5, 0, Math.PI*2);
                ctx.fill();
            });

            // Parçacıklar
            updateAndDrawParticles();

            ctx.restore();
            requestAnimationFrame(draw);
        }

        function drawGrid() {
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 2;
            for(let x=0; x<1200; x+=50) {
                ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,900); ctx.stroke();
            }
            for(let y=0; y<900; y+=50) {
                ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(1200,y); ctx.stroke();
            }
            // Harita Sınırı
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 5;
            ctx.strokeRect(0,0,1200,900);
        }

        function createExplosion(x, y, color) {
            for(let i=0; i<15; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color
                });
            }
        }

        function updateAndDrawParticles() {
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, Math.random()*3, 0, Math.PI*2);
                ctx.fill();
                
                if(p.life <= 0) particles.splice(i,1);
            }
            ctx.globalAlpha = 1;
        }

        function updateHUD() {
            if(!me) return;
            document.getElementById('info').innerText = `Sınıf: ${me.classType.toUpperCase()} | Skor: ${me.score}`;
            const hpPct = Math.max(0, (me.hp / (me.classType === 'tank' ? 150 : me.classType === 'sniper' ? 80 : 110)) * 100);
            document.getElementById('hp-fill').style.width = hpPct + '%';
            
            // Liderlik Tablosu
            let scores = Object.values(players).sort((a,b) => b.score - a.score).slice(0,5);
            let html = '<h3>Liderler</h3>';
            scores.forEach(p => {
                html += `<div>${p.classType}: ${p.score}</div>`;
            });
            document.getElementById('leaderboard').innerHTML = html;
        }

        draw();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON MIND: ONLINE</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; background: #080808; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; user-select: none; -webkit-user-select: none; }
        
        /* MENÃœ */
        #menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        h1 { font-size: 40px; text-shadow: 0 0 20px #0ff; margin-bottom: 10px; text-align: center; text-transform: uppercase; }
        
        .btn { width: 80%; max-width: 300px; padding: 20px; margin: 10px; font-size: 20px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; text-transform: uppercase; color: #fff; transition: 0.2s; }
        .btn-host { background: #ff0055; box-shadow: 0 0 15px #ff0055; }
        .btn-join { background: #00f2ff; box-shadow: 0 0 15px #00f2ff; color: #000; }
        
        .input-box { padding: 15px; font-size: 24px; text-align: center; width: 200px; margin-bottom: 10px; border-radius: 10px; border: 2px solid #555; background: #222; color: #fff; outline: none; }

        /* OYUN ALANI */
        #game { display: none; flex-direction: column; height: 100vh; }
        
        #status-bar { flex: 1; display: flex; justify-content: space-between; padding: 20px; font-size: 24px; font-weight: bold; background: #1a1a1a; border-bottom: 2px solid #333; }
        .p1-score { color: #00f2ff; }
        .p2-score { color: #ff0055; }

        #arena { flex: 4; position: relative; display: flex; justify-content: center; align-items: center; }
        
        #character { width: 100px; height: 100px; background: #333; border-radius: 50%; position: relative; transition: transform 0.3s; box-shadow: 0 0 30px #000; display: flex; justify-content: center; align-items: center; font-size: 40px; }
        
        .shield { border: 5px solid #00f2ff; box-shadow: 0 0 20px #00f2ff; background: rgba(0, 242, 255, 0.2); }
        .gun { border: 5px solid #ff0055; box-shadow: 0 0 20px #ff0055; background: rgba(255, 0, 85, 0.2); }

        #msg { position: absolute; top: 20px; font-size: 24px; text-align: center; width: 100%; text-shadow: 0 0 10px #fff; }

        /* KONTROLLER */
        #controls { flex: 2; display: flex; gap: 10px; padding: 20px; background: #1a1a1a; border-top: 2px solid #333; }
        .action-btn { flex: 1; background: #333; border: 2px solid #555; border-radius: 10px; color: #aaa; font-size: 30px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .action-btn:active { background: #555; transform: scale(0.95); }
        .selected { border-color: #fff; color: #fff; background: #444; box-shadow: 0 0 15px #fff; }

        /* Lobi */
        #lobby { display: none; text-align: center; }
        .code-disp { font-size: 60px; color: #ff0055; font-weight: bold; margin: 20px; letter-spacing: 5px; }

    </style>
</head>
<body>

    <div id="menu">
        <h1>NEON MIND<br><span style="font-size:18px; color:#888">ONLINE DUELLO</span></h1>
        
        <div id="start-btns">
            <button class="btn btn-host" onclick="setupHost()">ODA KUR (HOST)</button>
            <button class="btn btn-join" onclick="showJoin()">ODAYA GÄ°R (JOIN)</button>
        </div>

        <div id="join-form" style="display:none; flex-direction:column; align-items:center;">
            <input type="number" id="room-input" class="input-box" placeholder="KOD">
            <button class="btn btn-join" onclick="joinRoom()">BAÄžLAN</button>
            <button style="background:none; border:none; color:#888; margin-top:10px;" onclick="location.reload()">GERÄ°</button>
        </div>

        <div id="lobby">
            <p>ARKADAÅžINA BU SAYIYI SÃ–YLE:</p>
            <div class="code-disp" id="my-code">...</div>
            <p style="animation: blink 1s infinite">Rakip Bekleniyor...</p>
        </div>
    </div>

    <div id="game">
        <div id="status-bar">
            <div class="p1-score">SEN: <span id="s-me">0</span></div>
            <div class="p2-score">RAKÄ°P: <span id="s-opp">0</span></div>
        </div>

        <div id="arena">
            <div id="msg">HAMLENÄ° SEÃ‡...</div>
            <div id="character">?</div>
        </div>

        <div id="controls">
            <button class="action-btn" onclick="makeMove('L')">SOL</button>
            <button class="action-btn" onclick="makeMove('M')">ORTA</button>
            <button class="action-btn" onclick="makeMove('R')">SAÄž</button>
        </div>
    </div>

    <script>
        // --- AYARLAR ---
        let peer = null;
        let conn = null;
        let myRole = ''; // 'shooter' (AteÅŸ Eden) veya 'keeper' (Kalkan)
        let myMove = null;
        let oppMove = null;
        let scores = { me: 0, opp: 0 };
        let round = 1;

        // --- PEERJS BAÄžLANTI (KESÄ°N Ã‡ALIÅžAN KISIM) ---
        function generateCode() { return Math.floor(1000 + Math.random() * 9000); }

        function setupHost() {
            const code = generateCode();
            document.getElementById('start-btns').style.display = 'none';
            document.getElementById('lobby').style.display = 'block';
            document.getElementById('my-code').innerText = code;

            peer = new Peer(code.toString());
            
            peer.on('connection', (c) => {
                conn = c;
                setupConn();
                startGame('shooter'); // Host ilk saldÄ±rÄ±r
            });
            peer.on('error', err => alert("BaÄŸlantÄ± HatasÄ±: " + err));
        }

        function showJoin() {
            document.getElementById('start-btns').style.display = 'none';
            document.getElementById('join-form').style.display = 'flex';
        }

        function joinRoom() {
            const code = document.getElementById('room-input').value;
            if(!code) return;
            
            peer = new Peer();
            peer.on('open', () => {
                conn = peer.connect(code);
                conn.on('open', () => {
                    setupConn();
                    startGame('keeper'); // Giren ilk savunur
                });
                
                // BaÄŸlanamazsa 3sn sonra uyar
                setTimeout(() => { if(document.getElementById('menu').style.display !== 'none') alert("Oda bulunamadÄ±!"); }, 3000);
            });
        }

        function setupConn() {
            conn.on('data', (data) => {
                if(data.type === 'move') {
                    oppMove = data.val;
                    checkResult();
                }
            });
            conn.on('close', () => { alert("Rakip kaÃ§tÄ±!"); location.reload(); });
        }

        // --- OYUN MANTIÄžI ---
        function startGame(role) {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            myRole = role;
            newRound();
        }

        function newRound() {
            myMove = null;
            oppMove = null;
            
            // UI SÄ±fÄ±rla
            document.querySelectorAll('.action-btn').forEach(b => {
                b.classList.remove('selected');
                b.disabled = false;
            });
            
            const char = document.getElementById('character');
            char.innerHTML = "?";
            char.className = ""; // SÄ±nÄ±flarÄ± temizle
            char.style.transform = "scale(1)";

            updateRoleUI();
        }

        function updateRoleUI() {
            const msg = document.getElementById('msg');
            const char = document.getElementById('character');
            const btns = document.querySelectorAll('.action-btn');

            if(myRole === 'shooter') {
                msg.innerText = "SALDIRI SIRASI SENDE!";
                msg.style.color = "#ff0055";
                char.classList.add('gun');
                btns.forEach(b => { b.style.borderColor = "#ff0055"; b.style.color = "#ff0055"; });
            } else {
                msg.innerText = "SAVUNMA SIRASI SENDE!";
                msg.style.color = "#00f2ff";
                char.classList.add('shield');
                btns.forEach(b => { b.style.borderColor = "#00f2ff"; b.style.color = "#00f2ff"; });
            }
        }

        function makeMove(move) {
            if(myMove) return; // Zaten seÃ§tiysen engelle
            
            myMove = move;
            
            // Butonu seÃ§ili yap
            const btns = document.querySelectorAll('.action-btn');
            btns.forEach(b => b.disabled = true); // DiÄŸerlerine basmayÄ± engelle
            
            // SeÃ§ilen butonu boya
            if(move === 'L') btns[0].classList.add('selected');
            if(move === 'M') btns[1].classList.add('selected');
            if(move === 'R') btns[2].classList.add('selected');

            document.getElementById('msg').innerText = "RAKÄ°P BEKLENÄ°YOR...";
            
            // Rakibe gÃ¶nder
            conn.send({ type: 'move', val: move });
            
            checkResult();
        }

        function checkResult() {
            // Ä°ki taraf da seÃ§tiyse sonucu gÃ¶ster
            if(myMove && oppMove) {
                const char = document.getElementById('character');
                const msg = document.getElementById('msg');
                
                let iWonRound = false;

                if(myRole === 'shooter') {
                    // Ben saldÄ±rÄ±yordum
                    if(myMove !== oppMove) {
                        // FarklÄ± yerler -> GOL!
                        iWonRound = true;
                        msg.innerText = "VURDUN! ðŸ’¥";
                        scores.me++;
                        char.style.background = "#ff0055";
                        char.innerHTML = "ðŸ’¥";
                    } else {
                        // AynÄ± yer -> KURTARDI
                        iWonRound = false;
                        msg.innerText = "KURTARILDI! ðŸ›¡ï¸";
                        char.style.background = "#00f2ff";
                        char.innerHTML = "ðŸ›¡ï¸";
                    }
                } else {
                    // Ben savunuyordum
                    if(myMove === oppMove) {
                        // AynÄ± yer -> KURTARDIM
                        iWonRound = true;
                        msg.innerText = "TUTTUN! ðŸ›¡ï¸";
                        scores.me++;
                        char.style.background = "#00f2ff";
                        char.innerHTML = "ðŸ›¡ï¸";
                    } else {
                        // FarklÄ± yer -> YEDÄ°M
                        iWonRound = false;
                        msg.innerText = "YEDÄ°N! ðŸ’¥";
                        char.style.background = "#ff0055";
                        char.innerHTML = "ðŸ’¥";
                    }
                }

                // SkorlarÄ± gÃ¼ncelle
                document.getElementById('s-me').innerText = scores.me;
                document.getElementById('s-opp').innerText = scores.opp;

                // Animasyon
                char.style.transform = "scale(1.5)";

                // Rolleri DeÄŸiÅŸ
                setTimeout(() => {
                    myRole = (myRole === 'shooter') ? 'keeper' : 'shooter';
                    newRound();
                }, 2000);
            }
        }
    </script>
</body>
</html>

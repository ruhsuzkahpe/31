<script>
  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  const spinButton = document.getElementById('spin-button');
  const resultDiv = document.getElementById('result');
  const celebrationDiv = document.getElementById('celebration');
  let isSpinning = false;
  let rotation = 0;
  let spinSpeed = 0;

  // Çark segmentleri ve karakter isimleri
  const segments = [
    'Freddy Krueger', 'Jason Voorhees', 'Michael Myers', 'Pennywise', 'Ghostface', 'Chucky', 
    'Leatherface', 'Jigsaw', 'Terrifier', 'Samara Morgan', 'Altın Bilet', 'Sonsuz Dönüş', 
    'Kara Delik', 'Karmaşa Anı', 'Fırtına Patlaması', 'Zeka Etkisi'
  ];

  const colors = ['#ffa502', '#ff6348', '#ff4757', '#ff7f50', '#ffa502', '#ff6348', '#ff4757', 
                  '#ff7f50', '#ff6f61', '#ffa502', '#ff0099', '#ff33cc', '#00ffcc', '#ff00ff'];
  const radius = canvas.width / 2;

  // Çark çizim fonksiyonu
  function drawWheel() {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const angleStep = (2 * Math.PI) / segments.length;

    for (let i = 0; i < segments.length; i++) {
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, i * angleStep, (i + 1) * angleStep);
      ctx.closePath();
      ctx.fillStyle = colors[i % colors.length];
      ctx.fill();

      ctx.save();
      ctx.translate(centerX, centerY);
      ctx.rotate(i * angleStep + angleStep / 2);
      ctx.textAlign = 'center';
      ctx.fillStyle = '#2c2c54';
      ctx.font = '14px Arial';
      ctx.fillText(segments[i], radius / 1.5, 0);
      ctx.restore();
    }
  }

  // Çarkı döndürme fonksiyonu
  function spinWheel() {
    if (isSpinning) return;

    isSpinning = true;
    spinSpeed = Math.random() * 10 + 5; // Rastgele hız

    // "Karmaşa Anı" başladığında fırtına animasyonu ekle
    if (Math.random() > 0.8) {
      const stormDiv = document.createElement('div');
      stormDiv.classList.add('storm');
      document.body.appendChild(stormDiv);
      setTimeout(() => {
        stormDiv.remove();
      }, 3000);
    }

    const spinAnimation = setInterval(() => {
      rotation += spinSpeed;
      spinSpeed *= 0.97; // Yavaşlatma

      if (spinSpeed <= 0.1) {
        clearInterval(spinAnimation);
        isSpinning = false;
        spinSpeed = 0;
        showResult();
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate((rotation * Math.PI) / 180);
      drawWheel();
      ctx.restore();
    }, 1000 / 60); // 60 FPS
  }

  // Sonucu gösterme fonksiyonu
  function showResult() {
    const segmentIndex = Math.floor(((rotation % 360) / 360) * segments.length);
    resultDiv.innerHTML = `Kazandığınız Segment: <strong>${segments[segmentIndex]}</strong>`;
    resultDiv.style.display = 'block';

    // Eğer "Karmaşa Anı" geldi ise, kutlamayı göster
    if (segments[segmentIndex] === 'Karmaşa Anı') {
      celebrationDiv.classList.add('active');
      setTimeout(() => {
        celebrationDiv.classList.remove('active');
      }, 3000); // 3 saniye kutlama
    }
  }

  // Butona tıklama olayı
  spinButton.addEventListener('click', spinWheel);

  // Çarkı ilk başta çiz
  drawWheel();
</script>
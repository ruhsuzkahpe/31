<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HYPER NOVA: ULTIMATE</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; font-family: 'Courier New', sans-serif; }
        canvas { display: block; }
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between; padding: 10px; box-sizing: border-box;
        }
        .hud-text { color: #0ff; font-weight: bold; text-shadow: 0 0 5px #0ff; font-size: 20px; }
        #health-bar-container { width: 200px; height: 10px; border: 2px solid #fff; background: rgba(0,0,0,0.5); margin-top: 5px; }
        #health-fill { width: 100%; height: 100%; background: #0f0; transition: width 0.2s; box-shadow: 0 0 10px #0f0; }
        
        #start-screen, #game-over-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; pointer-events: auto; backdrop-filter: blur(5px);
        }
        h1 { color: #ff0055; font-size: 40px; margin: 0; text-shadow: 0 0 20px #ff0055; letter-spacing: 3px; text-align: center; }
        p { color: #fff; margin-top: 10px; font-size: 14px; text-align: center; opacity: 0.8; }
        .blink { animation: blinker 1s linear infinite; color: #0ff; margin-top: 30px; font-size: 18px; font-weight: bold; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div>
            <div class="hud-text">SKOR: <span id="scoreEl">0</span></div>
            <div id="health-bar-container"><div id="health-fill"></div></div>
        </div>
        <div class="hud-text" style="text-align: right; font-size: 14px;">BOSS: <span id="boss-status">YOK</span></div>
    </div>

    <div id="start-screen" onclick="startGame()">
        <h1>HYPER NOVA</h1>
        <p>PARMAĞINLA YÖNET • OTOMATİK ATEŞ</p>
        <p style="color:yellow">⚡ GÜÇLENDİRMELERİ TOPLA ⚡</p>
        <div class="blink">BAŞLAMAK İÇİN DOKUN</div>
    </div>

    <div id="game-over-screen" style="display: none;" onclick="startGame()">
        <h1 style="color: red;">GÖREV BAŞARISIZ</h1>
        <p>SKORUN: <span id="finalScore">0</span></p>
        <div class="blink">TEKRAR DENEMEK İÇİN DOKUN</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // --- AYARLAR VE KURULUM ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const uiHealth = document.getElementById('health-fill');
        const uiScore = document.getElementById('scoreEl');
        const uiBoss = document.getElementById('boss-status');

        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Oyun Durumu
        let gameActive = false;
        let score = 0;
        let frames = 0;
        let shakeIntensity = 0;

        // Ses Motoru (Basit Synth)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            if (type === 'shoot') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'explosion') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.linearRampToValueAtTime(10, now + 0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'powerup') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.linearRampToValueAtTime(1200, now + 0.2);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        // --- NESNELER ---
        
        const player = {
            x: width/2, y: height - 100, r: 15, hp: 100, maxHp: 100,
            powerLevel: 1, lastShot: 0
        };

        let bullets = [];
        let enemies = [];
        let particles = [];
        let powerups = [];
        let popups = []; // Hasar sayıları
        let boss = null;

        // --- YARDIMCI FONKSİYONLAR ---
        function drawGlowCircle(x, y, r, color) {
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        function spawnFloatingText(x, y, text, color) {
            popups.push({x, y, text, color, life: 1.0});
        }

        function createExplosion(x, y, color, count=10) {
            shakeIntensity = 5; // Ekranı salla
            playSound('explosion');
            for(let i=0; i<count; i++){
                particles.push({
                    x, y, color,
                    vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                    life: 1.0, decay: Math.random()*0.05+0.02
                });
            }
        }

        // --- OYUN MANTIĞI ---

        function startGame() {
            if(gameActive) return;
            gameActive = true;
            score = 0;
            frames = 0;
            boss = null;
            
            player.hp = 100;
            player.powerLevel = 1;
            player.x = width/2;
            player.y = height - 100;

            bullets = []; enemies = []; particles = []; powerups = []; popups = [];
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'none';
            uiBoss.innerText = "YOK";
            uiBoss.style.color = "#fff";
            
            loop();
        }

        function spawnEnemy() {
            if(boss) return; // Boss varken düşman gelmesin
            const size = Math.random() * 15 + 10;
            enemies.push({
                x: Math.random() * (width - 40) + 20,
                y: -50,
                r: size,
                hp: Math.floor(size),
                speed: Math.random() * 2 + 1 + (score/1000),
                color: '#ff0055',
                type: 'basic'
            });
        }

        function spawnBoss() {
            boss = {
                x: width/2, y: -100, r: 60, hp: 500, maxHp: 500,
                vx: 2, phase: 0, shootTimer: 0
            };
            uiBoss.innerText = "⚠️ GELİYOR ⚠️";
            uiBoss.style.color = "red";
            createExplosion(width/2, 100, '#fff', 20);
        }

        function updatePlayer() {
            // Can barı güncelle
            uiHealth.style.width = (player.hp / player.maxHp * 100) + "%";
            if(player.hp <= 0) gameOver();

            // Ateş Etme
            if(frames - player.lastShot > 10) { // Ateş hızı
                player.lastShot = frames;
                playSound('shoot');
                
                // Silah Seviyeleri
                if(player.powerLevel === 1) {
                    bullets.push({x: player.x, y: player.y, vx: 0, vy: -15, dmg: 5, color: '#ffff00'});
                } else if(player.powerLevel === 2) {
                    bullets.push({x: player.x-10, y: player.y, vx: 0, vy: -15, dmg: 5, color: '#00ffcc'});
                    bullets.push({x: player.x+10, y: player.y, vx: 0, vy: -15, dmg: 5, color: '#00ffcc'});
                } else {
                    bullets.push({x: player.x, y: player.y, vx: 0, vy: -15, dmg: 5, color: '#ff00ff'});
                    bullets.push({x: player.x, y: player.y, vx: -3, vy: -12, dmg: 5, color: '#ff00ff'});
                    bullets.push({x: player.x, y: player.y, vx: 3, vy: -12, dmg: 5, color: '#ff00ff'});
                }
            }
        }

        function updateBoss() {
            if(!boss) return;
            
            // Boss Hareketi (Giriş animasyonu ve sağ sol)
            if(boss.y < 100) boss.y += 1;
            else {
                boss.x += boss.vx;
                if(boss.x > width - 50 || boss.x < 50) boss.vx *= -1;
            }

            // Boss Çizimi
            ctx.shadowBlur = 30;
            ctx.shadowColor = 'red';
            ctx.fillStyle = '#500';
            ctx.beginPath(); ctx.arc(boss.x, boss.y, boss.r, 0, Math.PI*2); ctx.fill();
            // Boss Gözü
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(boss.x, boss.y, boss.r/2, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // Boss Canı (Text olarak)
            uiBoss.innerText = "CAN: " + boss.hp;

            // Boss Ateşi
            boss.shootTimer++;
            if(boss.shootTimer > 40) {
                boss.shootTimer = 0;
                // Oyuncuya doğru ateş
                let angle = Math.atan2(player.y - boss.y, player.x - boss.x);
                enemies.push({ // Mermiyi enemy olarak ekliyoruz (daha basit)
                    x: boss.x, y: boss.y + 50, r: 8, hp: 1, speed: 0,
                    vx: Math.cos(angle)*8, vy: Math.sin(angle)*8,
                    color: '#fff', type: 'bullet'
                });
            }

            if(boss.hp <= 0) {
                createExplosion(boss.x, boss.y, '#ff0000', 50);
                spawnFloatingText(boss.x, boss.y, "+5000", "#gold");
                score += 5000;
                boss = null;
                uiBoss.innerText = "YOK EDİLDİ";
                uiBoss.style.color = "#0f0";
                // Zorluğu artır
            }
        }

        function loop() {
            if(!gameActive) return;
            requestAnimationFrame(loop);
            frames++;

            // Ekranı temizle ve salla
            ctx.save();
            if(shakeIntensity > 0) {
                let dx = (Math.random()-0.5)*shakeIntensity;
                let dy = (Math.random()-0.5)*shakeIntensity;
                ctx.translate(dx, dy);
                shakeIntensity *= 0.9;
            }
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // Motion blur
            ctx.fillRect(0, 0, width, height);

            // Yıldızlar (Arkaplan Hızı efekti)
            ctx.fillStyle = 'white';
            for(let i=0; i<5; i++) {
                ctx.fillRect(Math.random()*width, Math.random()*height, 2, 2);
            }

            updatePlayer();
            
            // Oyuncuyu Çiz
            drawGlowCircle(player.x, player.y, player.r, player.powerLevel > 2 ? '#ff00ff' : '#00ffff');

            // Mermiler
            for(let i = bullets.length - 1; i >= 0; i--) {
                let b = bullets[i];
                b.x += b.vx; b.y += b.vy;
                drawGlowCircle(b.x, b.y, 4, b.color);
                if(b.y < 0) bullets.splice(i, 1);
            }

            // Düşman Spawn
            if(frames % 40 === 0) spawnEnemy();
            if(score > 2000 && !boss && frames % 1000 === 0) spawnBoss(); // 2000 puandan sonra boss şansı

            updateBoss();

            // Düşmanlar
            for(let i = enemies.length - 1; i >= 0; i--) {
                let e = enemies[i];
                if(e.type === 'basic') e.y += e.speed;
                else { e.x += e.vx; e.y += e.vy; } // Mermi ise
                
                drawGlowCircle(e.x, e.y, e.r, e.color);

                // Oyuncu ile çarpışma
                let dist = Math.hypot(player.x - e.x, player.y - e.y);
                if(dist < player.r + e.r) {
                    player.hp -= 20;
                    createExplosion(e.x, e.y, e.color);
                    enemies.splice(i, 1);
                    continue;
                }

                // Mermi ile vurulma
                for(let j = bullets.length - 1; j >= 0; j--) {
                    let b = bullets[j];
                    let distB = Math.hypot(b.x - e.x, b.y - e.y);
                    if(distB < e.r + 4) {
                        e.hp -= b.dmg;
                        bullets.splice(j, 1);
                        createExplosion(b.x, b.y, '#fff', 2);
                        
                        if(e.hp <= 0) {
                            // ÖLDÜ
                            spawnFloatingText(e.x, e.y, "100", "#fff");
                            score += 100;
                            uiScore.innerText = score;
                            createExplosion(e.x, e.y, e.color);
                            
                            // Powerup düşürme şansı
                            if(Math.random() > 0.9 && e.type === 'basic') {
                                powerups.push({x: e.x, y: e.y, type: 'gun'});
                            }
                            
                            enemies.splice(i, 1);
                        }
                        break;
                    }
                }
                
                // Boss Vurulma
                if(boss) {
                    for(let j = bullets.length - 1; j >= 0; j--) {
                        let b = bullets[j];
                        let distBoss = Math.hypot(b.x - boss.x, b.y - boss.y);
                        if(distBoss < boss.r) {
                            boss.hp -= b.dmg;
                            bullets.splice(j, 1);
                            spawnFloatingText(b.x, b.y, b.dmg, "red");
                        }
                    }
                }

                if(e.y > height + 50) enemies.splice(i, 1);
            }

            // Powerups
            for(let i = powerups.length - 1; i >= 0; i--) {
                let p = powerups[i];
                p.y += 3;
                ctx.font = "30px Arial";
                ctx.fillText("⚡", p.x-10, p.y);
                
                let dist = Math.hypot(player.x - p.x, player.y - p.y);
                if(dist < player.r + 20) {
                    playSound('powerup');
                    player.powerLevel = Math.min(player.powerLevel + 1, 3);
                    player.hp = Math.min(player.hp + 20, 100); // Can da ver
                    spawnFloatingText(player.x, player.y, "LEVEL UP!", "#0ff");
                    powerups.splice(i, 1);
                }
            }

            // Parçacıklar
            for(let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= p.decay;
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, Math.random()*3, 0, Math.PI*2); ctx.fill();
                ctx.globalAlpha = 1;
                if(p.life <= 0) particles.splice(i, 1);
            }

            // Floating Text (Sayılar)
            for(let i = popups.length - 1; i >= 0; i--) {
                let t = popups[i];
                t.y -= 1; t.life -= 0.02;
                ctx.globalAlpha = t.life;
                ctx.fillStyle = t.color;
                ctx.font = "bold 20px Arial";
                ctx.fillText(t.text, t.x, t.y);
                ctx.globalAlpha = 1;
                if(t.life <= 0) popups.splice(i, 1);
            }
            
            ctx.restore();
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('finalScore').innerText = score;
            document.getElementById('game-over-screen').style.display = 'flex';
        }

        // --- KONTROLLER ---
        function handleMove(e) {
            if(!gameActive) return;
            e.preventDefault();
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            // Parmağın biraz üstünde dursun ki gemiyi görebil (Y ekseni offset)
            const y = e.touches ? e.touches[0].clientY - 50 : e.clientY - 50;
            
            player.x += (x - player.x) * 0.2; // Yumuşak takip
            player.y += (y - player.y) * 0.2;
        }

        window.addEventListener('touchstart', handleMove, {passive: false});
        window.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('mousemove', handleMove);

    </script>
</body>
</html>

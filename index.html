<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON SUMO ONLINE</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; background: #111; overflow: hidden; touch-action: none; font-family: 'Segoe UI', sans-serif; color: white; user-select: none; -webkit-user-select: none; }
        canvas { display: block; }

        /* MENÃœ TASARIMI */
        #menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 20;
        }
        h1 { font-size: 50px; color: #fff; text-shadow: 0 0 20px #ff0055; margin: 0; letter-spacing: 2px; text-align: center; }
        p { color: #aaa; margin-bottom: 30px; font-size: 16px; }
        
        .btn {
            width: 260px; padding: 15px; margin: 10px; font-size: 20px; font-weight: bold;
            border: none; border-radius: 50px; cursor: pointer; text-transform: uppercase;
            transition: transform 0.1s; color: white;
        }
        .btn-host { background: linear-gradient(45deg, #ff0055, #ff5500); box-shadow: 0 0 20px #ff0055; }
        .btn-join { background: linear-gradient(45deg, #00f2ff, #0055ff); box-shadow: 0 0 20px #00f2ff; }
        .btn:active { transform: scale(0.95); }

        /* INPUT ALANI */
        #join-ui { display: none; flex-direction: column; align-items: center; }
        input {
            background: #222; border: 2px solid #555; padding: 15px; width: 200px;
            font-size: 24px; color: #fff; text-align: center; border-radius: 10px;
            margin-bottom: 15px; outline: none; letter-spacing: 3px;
        }

        /* LOBÄ° */
        #lobby-ui { display: none; text-align: center; }
        .code { font-size: 70px; font-weight: bold; color: #ff0055; letter-spacing: 5px; margin: 10px 0; }
        
        /* KAZANAN EKRANI */
        #win-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 30; pointer-events: none;
        }
        #win-text { font-size: 60px; font-weight: bold; text-shadow: 0 0 30px white; }

    </style>
</head>
<body>

    <div id="win-ui"><div id="win-text">KAZANDIN!</div></div>

    <div id="menu">
        <h1>NEON SUMO</h1>
        <p>DÃ–N â€¢ BASILI TUT â€¢ Ã‡ARPIÅž</p>

        <div id="main-ui">
            <button class="btn btn-host" onclick="setupHost()">ODA KUR</button>
            <button class="btn btn-join" onclick="showJoin()">ODAYA KATIL</button>
        </div>

        <div id="join-ui">
            <input type="number" id="room-code" placeholder="KOD" maxlength="4">
            <button class="btn btn-join" onclick="joinRoom()">BAÄžLAN</button>
            <button class="btn" style="background:transparent; color:#aaa; font-size:14px;" onclick="location.reload()">GERÄ°</button>
        </div>

        <div id="lobby-ui">
            <p>ARKADAÅžINA BU KODU VER:</p>
            <div class="code" id="my-code">...</div>
            <div style="color:#888; animation: pulse 1s infinite;">Rakip Bekleniyor...</div>
        </div>
    </div>

    <canvas id="c"></canvas>

    <script>
        // --- AYARLAR ---
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        let w, h;
        
        let role = null; // 'host' | 'client'
        let peer = null, conn = null;
        
        // OYUN DURUMU (Fiziksel DÃ¼nya)
        const game = {
            active: false,
            winner: null,
            arena: { r: 0 }, // Ã‡ember yarÄ±Ã§apÄ±
            // Oyuncu 1 (Host - KÄ±rmÄ±zÄ±)
            p1: { x: 0, y: 0, r: 25, angle: 0, vx: 0, vy: 0, boosting: false, color: '#ff0055' },
            // Oyuncu 2 (Client - Mavi)
            p2: { x: 0, y: 0, r: 25, angle: 0, vx: 0, vy: 0, boosting: false, color: '#00f2ff' },
            particles: []
        };

        // Ä°stemci tarafÄ± girdisi
        let isTouching = false;

        function resize() { 
            w = c.width = window.innerWidth; 
            h = c.height = window.innerHeight; 
            // Arena baÅŸlangÄ±Ã§ boyutu (EkranÄ±n %90'Ä±)
            if(!game.active) game.arena.r = Math.min(w,h) * 0.45;
        }
        window.addEventListener('resize', resize); resize();

        // --- AÄž (PEERJS) ---
        function generateCode() { return Math.floor(1000 + Math.random() * 9000); }

        function setupHost() {
            const code = generateCode();
            document.getElementById('main-ui').style.display = 'none';
            document.getElementById('lobby-ui').style.display = 'block';
            document.getElementById('my-code').innerText = code;

            peer = new Peer(code.toString());
            peer.on('connection', (c) => {
                conn = c;
                setupConn();
                startGame(); // BaÄŸlanÄ±nca hemen baÅŸla
            });
        }

        function showJoin() {
            document.getElementById('main-ui').style.display = 'none';
            document.getElementById('join-ui').style.display = 'flex';
        }

        function joinRoom() {
            const code = document.getElementById('room-code').value;
            if(!code) return;
            peer = new Peer();
            peer.on('open', () => {
                conn = peer.connect(code);
                conn.on('open', () => {
                    setupConn();
                    role = 'client';
                    document.getElementById('menu').style.display = 'none';
                    loop(); // DÃ¶ngÃ¼yÃ¼ baÅŸlat
                });
            });
        }

        function setupConn() {
            conn.on('data', (data) => {
                if (role === 'client' && data.type === 'state') {
                    // Client sadece Ã§izim iÃ§in veriyi alÄ±r
                    game.p1 = data.p1;
                    game.p2 = data.p2;
                    game.arena = data.arena;
                    game.winner = data.winner;
                    if(data.boom) createParticles(data.boom.x, data.boom.y, data.boom.c);
                    if(game.winner) showWin(game.winner === 'p2');

                } else if (role === 'host' && data.type === 'input') {
                    // Host, Client'Ä±n "BasÄ±yor mu?" bilgisini alÄ±r
                    game.p2.boosting = data.boosting;
                }
            });
            
            conn.on('close', () => { alert("BaÄŸlantÄ± koptu!"); location.reload(); });
        }

        function startGame() {
            role = 'host';
            document.getElementById('menu').style.display = 'none';
            
            // BaÅŸlangÄ±Ã§ PozisyonlarÄ±
            game.p1.x = w/2 - 100; game.p1.y = h/2;
            game.p2.x = w/2 + 100; game.p2.y = h/2;
            game.p1.vx = 0; game.p1.vy = 0;
            game.p2.vx = 0; game.p2.vy = 0;
            game.arena.r = Math.min(w,h) * 0.45;
            game.active = true;
            
            loop();

            // Host Veri GÃ¶nderimi (Saniyede 30)
            setInterval(() => {
                if(game.active) {
                    conn.send({
                        type: 'state',
                        p1: game.p1,
                        p2: game.p2,
                        arena: game.arena,
                        winner: game.winner
                    });
                }
            }, 33);
        }

        // --- OYUN FÄ°ZÄ°ÄžÄ° (SADECE HOST) ---
        function updatePhysics() {
            if(!game.active || game.winner) return;

            // Arena DaralmasÄ±
            if(game.arena.r > 100) game.arena.r -= 0.05;

            // OyuncularÄ± GÃ¼ncelle
            updatePlayer(game.p1, role === 'host' ? isTouching : false); // Host kendi inputu
            updatePlayer(game.p2, game.p2.boosting); // Client network inputu

            // Ã‡arpÄ±ÅŸma KontrolÃ¼ (Sumo MantÄ±ÄŸÄ±)
            let dx = game.p2.x - game.p1.x;
            let dy = game.p2.y - game.p1.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            let minDist = game.p1.r + game.p2.r;

            if (dist < minDist) {
                // Ã‡ARPIÅžMA!
                let angle = Math.atan2(dy, dx);
                let force = 8; // Ä°tme gÃ¼cÃ¼
                
                // Birbirlerini itekle
                game.p1.vx -= Math.cos(angle) * force;
                game.p1.vy -= Math.sin(angle) * force;
                game.p2.vx += Math.cos(angle) * force;
                game.p2.vy += Math.sin(angle) * force;
                
                // Efekt GÃ¶nder
                let cx = (game.p1.x + game.p2.x)/2;
                let cy = (game.p1.y + game.p2.y)/2;
                createParticles(cx, cy, '#fff');
                conn.send({type:'state', p1:game.p1, p2:game.p2, arena:game.arena, boom:{x:cx,y:cy,c:'#fff'}});
            }

            // Arena DÄ±ÅŸÄ±na Ã‡Ä±kma (Ã–lÃ¼m)
            checkBounds(game.p1, 'p1');
            checkBounds(game.p2, 'p2');
        }

        function updatePlayer(p, isPressing) {
            // SÃ¼rekli DÃ¶nme
            p.angle += 0.1;

            // SÃ¼rtÃ¼nme (YavaÅŸlama)
            p.vx *= 0.95;
            p.vy *= 0.95;

            // BasÄ±yorsa Ä°leri Git (Boost)
            if (isPressing) {
                // DÃ¶nme aÃ§Ä±sÄ±na gÃ¶re kuvvet uygula
                p.vx += Math.cos(p.angle) * 0.8;
                p.vy += Math.sin(p.angle) * 0.8;
                // DÃ¶nerken aÃ§Ä±yÄ± kilitleme (Strateji iÃ§in dÃ¶nmeye devam etsin mi? Evet, sumo stili)
            }

            p.x += p.vx;
            p.y += p.vy;
        }

        function checkBounds(p, pid) {
            let dx = p.x - w/2;
            let dy = p.y - h/2;
            let dist = Math.sqrt(dx*dx + dy*dy);

            // EÄŸer merkezden uzaklÄ±k > arena yarÄ±Ã§apÄ± ise DÃœÅžTÃœ
            if (dist > game.arena.r + p.r) {
                game.winner = pid === 'p1' ? 'p2' : 'p1'; // DiÄŸeri kazandÄ±
                game.active = false;
                showWin(role === 'host' ? (game.winner === 'p1') : (game.winner === 'p2'));
            }
        }

        function showWin(iWon) {
            const ui = document.getElementById('win-ui');
            const txt = document.getElementById('win-text');
            ui.style.display = 'flex';
            if(iWon) {
                txt.innerText = "KAZANDIN! ðŸ‘‘";
                txt.style.color = "#0f0";
            } else {
                txt.innerText = "ELENDÄ°N ðŸ’€";
                txt.style.color = "#f00";
            }
            setTimeout(() => location.reload(), 3000);
        }

        // --- Ã‡Ä°ZÄ°M ---
        function draw() {
            // Temizle
            ctx.fillStyle = '#111'; ctx.fillRect(0,0,w,h);

            // ARENA
            ctx.strokeStyle = '#fff'; 
            ctx.lineWidth = 5;
            ctx.setLineDash([20, 20]);
            ctx.beginPath(); ctx.arc(w/2, h/2, game.arena.r, 0, Math.PI*2); ctx.stroke();
            ctx.setLineDash([]);

            // OyuncularÄ± Ã‡iz
            drawPlayerObj(game.p1);
            drawPlayerObj(game.p2);

            // Efektler
            for(let i=game.particles.length-1; i>=0; i--) {
                let pt = game.particles[i];
                pt.x += pt.vx; pt.y += pt.vy; pt.life -= 0.05;
                ctx.globalAlpha = pt.life; ctx.fillStyle = pt.c;
                ctx.beginPath(); ctx.arc(pt.x, pt.y, 4, 0, Math.PI*2); ctx.fill();
                if(pt.life<=0) game.particles.splice(i,1);
            }
            ctx.globalAlpha = 1;
        }

        function drawPlayerObj(p) {
            ctx.save();
            ctx.translate(p.x, p.y);
            
            // Parlama
            ctx.shadowBlur = 20; ctx.shadowColor = p.color;
            
            // GÃ¶vde
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(0, 0, p.r, 0, Math.PI*2); ctx.fill();
            
            // YÃ¶n GÃ¶stergesi (GÃ¶z)
            ctx.rotate(p.angle);
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(p.r-5, 0, 8, 0, Math.PI*2); ctx.fill();
            
            // Boost Efekti
            if(p.boosting || (role==='host' && p===game.p1 && isTouching) || (role==='client' && p===game.p2 && isTouching)) {
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 3;
                ctx.beginPath(); ctx.arc(0, 0, p.r+5, 0, Math.PI*2); ctx.stroke();
            }

            ctx.restore();
        }

        function createParticles(x, y, c) {
            for(let i=0; i<15; i++) {
                game.particles.push({
                    x:x, y:y, c:c, life:1,
                    vx:(Math.random()-0.5)*10, vy:(Math.random()-0.5)*10
                });
            }
        }

        // --- DÃ–NGÃœ ---
        function loop() {
            requestAnimationFrame(loop);
            if(role === 'host') updatePhysics();
            else {
                // Client sÃ¼rekli input gÃ¶nderir
                conn.send({ type: 'input', boosting: isTouching });
            }
            draw();
        }

        // --- KONTROLLER ---
        // Sadece basÄ±lÄ± tutma var
        window.addEventListener('touchstart', (e) => { e.preventDefault(); isTouching = true; }, {passive:false});
        window.addEventListener('touchend', (e) => { e.preventDefault(); isTouching = false; });
        window.addEventListener('mousedown', () => isTouching = true);
        window.addEventListener('mouseup', () => isTouching = false);

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON DASH: INFINITY</title>
    <style>
        body { margin: 0; background: #111; overflow: hidden; touch-action: none; font-family: 'Arial Black', sans-serif; user-select: none; -webkit-user-select: none; }
        canvas { display: block; width: 100%; height: 100%; }
        
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }
        
        #score-disp {
            position: absolute; top: 10%;
            font-size: 60px; color: rgba(255,255,255,0.2);
            font-weight: 900;
        }

        #start-msg {
            font-size: 24px; color: #fff; text-align: center;
            text-shadow: 0 0 20px #0ff; animation: pulse 1s infinite;
        }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="ui">
        <div id="score-disp">0</div>
        <div id="start-msg">BAŞLAMAK İÇİN DOKUN</div>
    </div>
    <canvas id="c"></canvas>

    <script>
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        const uiMsg = document.getElementById('start-msg');
        const scoreEl = document.getElementById('score-disp');

        let w, h;
        let gameActive = false;
        let frame = 0;
        let score = 0;
        let speed = 6;
        let hue = 0;

        // --- OYUNCU AYARLARI ---
        const player = {
            x: 100, y: 0, w: 40, h: 40,
            dy: 0, jumpPower: -14, gravity: 0.8,
            grounded: false, rotation: 0,
            color: '#0ff',
            trail: []
        };

        let obstacles = [];
        let particles = [];
        let floorHeight = 0;

        function resize() {
            w = c.width = window.innerWidth;
            h = c.height = window.innerHeight;
            floorHeight = h - 100;
            if(!gameActive) player.y = floorHeight - player.h;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- OYUN DÖNGÜSÜ ---
        function loop() {
            requestAnimationFrame(loop);
            
            // Arkaplan (Hafif renk değişimi)
            hue += 0.5;
            ctx.fillStyle = `hsl(${hue}, 20%, 10%)`;
            ctx.fillRect(0, 0, w, h);

            // ZEMİN (Neon Çizgi)
            ctx.shadowBlur = 20; 
            ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.fillRect(0, floorHeight, w, 10);
            ctx.shadowBlur = 0;

            if (!gameActive) {
                // Bekleme Modunda Oyuncu Animasyonu
                player.y = floorHeight - player.h - Math.abs(Math.sin(Date.now()/200)*20);
                drawPlayer();
                return;
            }

            updatePlayer();
            updateObstacles();
            updateParticles();
            drawPlayer();

            // Skor ve Hızlanma
            score++;
            scoreEl.innerText = Math.floor(score / 10);
            speed += 0.002; // Yavaşça hızlan
            
            frame++;
        }

        // --- OYUNCU MANTIĞI ---
        function updatePlayer() {
            // Yerçekimi
            player.dy += player.gravity;
            player.y += player.dy;

            // Zemin Kontrolü
            if (player.y + player.h > floorHeight) {
                player.y = floorHeight - player.h;
                player.dy = 0;
                player.grounded = true;
                
                // Yerdeyken dönmeyi sıfırla (en yakın 90 dereceye)
                player.rotation = Math.round(player.rotation / (Math.PI/2)) * (Math.PI/2);
            } else {
                player.grounded = false;
                player.rotation += 0.1; // Havada dön
            }

            // Trail (İz) Efekti
            if (frame % 3 === 0) {
                player.trail.push({ x: player.x, y: player.y, r: player.rotation, alpha: 0.8 });
            }
            for (let i = player.trail.length - 1; i >= 0; i--) {
                let t = player.trail[i];
                t.x -= speed; // İz geriye kaysın
                t.alpha -= 0.05;
                if (t.alpha <= 0) player.trail.splice(i, 1);
            }
        }

        function drawPlayer() {
            // Trail Çizimi
            player.trail.forEach(t => {
                ctx.save();
                ctx.translate(t.x + player.w/2, t.y + player.h/2);
                ctx.rotate(t.r);
                ctx.fillStyle = `rgba(0, 255, 255, ${t.alpha})`;
                ctx.fillRect(-player.w/2, -player.h/2, player.w, player.h);
                ctx.restore();
            });

            // Oyuncu Çizimi
            ctx.save();
            ctx.translate(player.x + player.w/2, player.y + player.h/2);
            ctx.rotate(player.rotation);
            
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#0ff';
            ctx.fillStyle = '#fff'; // İç renk beyaz
            ctx.fillRect(-player.w/2, -player.h/2, player.w, player.h);
            
            // Neon Kenar
            ctx.strokeStyle = '#0ff';
            ctx.lineWidth = 3;
            ctx.strokeRect(-player.w/2, -player.h/2, player.w, player.h);
            
            ctx.restore();
        }

        // --- ENGEL MANTIĞI ---
        function updateObstacles() {
            // Engel Ekleme
            if (frame % 100 === 0 || (Math.random() < 0.02 && frame > 100 && obstacles.length < 2)) {
                // Minimum mesafe kontrolü
                let lastObs = obstacles[obstacles.length-1];
                if (!lastObs || (w - lastObs.x > 250)) { // Engeller arası boşluk
                    let type = Math.random();
                    let obsH = type > 0.7 ? 70 : 40; // Bazen büyük engel
                    let isFlying = type < 0.2; // %20 ihtimalle uçan engel
                    
                    obstacles.push({
                        x: w,
                        y: isFlying ? floorHeight - 90 : floorHeight - obsH,
                        w: 40,
                        h: obsH,
                        color: `hsl(${hue + 180}, 100%, 50%)` // Zıt renk
                    });
                }
            }

            for (let i = obstacles.length - 1; i >= 0; i--) {
                let o = obstacles[i];
                o.x -= speed;

                // Çizim (Üçgenimsi Dikenler veya Bloklar)
                ctx.fillStyle = o.color;
                ctx.shadowBlur = 15; ctx.shadowColor = o.color;
                ctx.fillRect(o.x, o.y, o.w, o.h);
                ctx.shadowBlur = 0;

                // Çarpışma Kontrolü (Basit AABB)
                if (
                    player.x < o.x + o.w &&
                    player.x + player.w > o.x &&
                    player.y < o.y + o.h &&
                    player.y + player.h > o.y
                ) {
                    die();
                }

                // Ekrandan çıktıysa sil
                if (o.x + o.w < 0) obstacles.splice(i, 1);
            }
        }

        // --- EFEKTLER ---
        function die() {
            gameActive = false;
            uiMsg.innerHTML = "YANDIN!<br>SKOR: " + Math.floor(score/10);
            uiMsg.style.display = 'block';
            
            // Patlama Efekti
            for(let i=0; i<30; i++) {
                particles.push({
                    x: player.x + player.w/2,
                    y: player.y + player.h/2,
                    vx: (Math.random()-0.5) * 20,
                    vy: (Math.random()-0.5) * 20,
                    life: 1,
                    color: player.color
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= 0.03;
                p.vy += 0.5; // Parçacıklara yerçekimi
                
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
                ctx.globalAlpha = 1;

                if(p.life <= 0) particles.splice(i, 1);
            }
        }

        // --- KONTROLLER ---
        function jump(e) {
            if (e) e.preventDefault();
            
            if (!gameActive) {
                // Oyunu Başlat
                gameActive = true;
                uiMsg.style.display = 'none';
                score = 0; speed = 7;
                obstacles = []; particles = [];
                player.y = floorHeight - player.h;
                player.trail = [];
                return;
            }

            if (player.grounded) {
                player.dy = player.jumpPower;
                player.grounded = false;
                
                // Zıplama Efekti (Küçük parçacıklar)
                for(let i=0; i<5; i++) {
                    particles.push({
                        x: player.x + player.w/2, y: player.y + player.h,
                        vx: (Math.random()-0.5)*5, vy: Math.random()*-2,
                        life: 0.5, color: '#fff'
                    });
                }
            }
        }

        window.addEventListener('touchstart', jump, {passive: false});
        window.addEventListener('mousedown', jump);
        window.addEventListener('keydown', (e) => { if(e.code === 'Space') jump(); });

        loop();

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON ARENA: ONLINE</title>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; touch-action: none; font-family: 'Segoe UI', sans-serif; user-select: none; color: white; }
        canvas { display: block; }
        
        /* Aray√ºz */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; padding: 20px; box-sizing: border-box; }
        #top-hud { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; text-shadow: 0 0 5px #fff; }
        
        /* Dash Butonu */
        #dash-btn { position: absolute; bottom: 40px; right: 30px; width: 90px; height: 90px; border-radius: 50%; border: 3px solid #00f2ff; background: rgba(0,242,255,0.15); display: flex; justify-content: center; align-items: center; pointer-events: auto; color: #00f2ff; font-weight: bold; box-shadow: 0 0 20px #00f2ff; transition: 0.1s; cursor: pointer; font-size: 14px; }
        #dash-btn:active { transform: scale(0.9); background: rgba(0,242,255,0.4); }
        
        /* Men√ºler */
        #screens { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5,5,5,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 20; pointer-events: auto; backdrop-filter: blur(5px); }
        
        h1 { font-size: 40px; color: #fff; text-shadow: 0 0 20px #bd00ff; margin-bottom: 20px; letter-spacing: 2px; text-align: center;}
        
        input { background: transparent; border: 2px solid #bd00ff; border-radius: 8px; color: white; font-size: 20px; text-align: center; margin-bottom: 20px; padding: 10px; outline: none; width: 220px; box-shadow: 0 0 10px rgba(189,0,255,0.3); }
        
        button { padding: 15px 50px; background: #bd00ff; border: none; color: white; font-size: 18px; border-radius: 30px; cursor: pointer; font-weight: bold; box-shadow: 0 0 20px #bd00ff; transition: 0.2s; text-transform: uppercase; }
        button:hover { transform: scale(1.05); box-shadow: 0 0 40px #bd00ff; }

        /* Liderlik Tablosu */
        #leaderboard-container {
            width: 85%; max-width: 350px;
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid #00f2ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
        }
        .lb-title { text-align: center; color: #00f2ff; margin-bottom: 10px; font-size: 14px; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        .lb-row { display: flex; justify-content: space-between; padding: 8px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 16px; }
        .lb-rank { color: #bd00ff; font-weight: bold; width: 25px; }
        .lb-name { flex-grow: 1; text-align: left; color: #eee; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px;}
        .lb-score { color: #00f2ff; font-weight: bold; }
        .loading { text-align: center; color: #aaa; padding: 20px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="ui-layer" style="display:none;">
        <div id="top-hud">
            <span>SKOR: <span id="scoreVal">0</span></span>
            <span id="displayNick" style="color:#bd00ff">OYUNCU</span>
        </div>
        <div id="dash-btn">DASH!</div>
    </div>

    <div id="screens">
        <h1>NEON ARENA<br><span style="font-size:20px; color:#00f2ff; text-shadow:none;">ONLINE</span></h1>
        
        <div id="login-view" style="display:flex; flex-direction:column; align-items:center;">
            <input type="text" id="nickInput" placeholder="Takma Adƒ±n" maxlength="10">
            <button onclick="startGame()">ARENAYA Gƒ∞R</button>
            
            <div id="leaderboard-container">
                <div class="lb-title">üåç GLOBAL SIRALAMA</div>
                <div id="lb-list-start" class="loading">Sunucuya baƒülanƒ±yor...</div>
            </div>
        </div>

        <div id="end-view" style="display:none; flex-direction:column; align-items:center; width:100%;">
            <h2 style="color:#ff0055; font-size: 36px; margin: 0; text-shadow: 0 0 20px red;">ELENDƒ∞N</h2>
            <p style="font-size: 24px; margin: 10px;">SKORUN: <span id="finalScore">0</span></p>
            
            <div id="leaderboard-container">
                <div class="lb-title">üèÜ EN ƒ∞Yƒ∞ OYUNCULAR</div>
                <div id="lb-list-end" class="loading">Skor kaydediliyor...</div>
            </div>
            
            <button style="margin-top:20px; background:#00f2ff; color:#000; box-shadow: 0 0 20px #00f2ff;" onclick="location.reload()">TEKRAR DENE</button>
        </div>
    </div>

    <canvas id="c"></canvas>

    <script>
        // SENƒ∞N VERDƒ∞ƒûƒ∞N KODLAR EKLENDƒ∞ ‚úÖ
        const PUBLIC_CODE  = "5fa8af5feb371a09c4c51d17";
        const PRIVATE_CODE = "cgpr101Ep0yMn0IZPhMAqwVghoK20BG06c_rPh-i1Npg";
        // ---------------------------------------------------

        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        let w, h;
        let gameActive = false;
        let score = 0;
        let nickname = "Misafir";
        
        // --- SUNUCU ƒ∞≈ûLEMLERƒ∞ (DREAMLO) ---
        
        async function sendScore(name, score) {
            // T√ºrk√ße karakter ve bo≈üluk temizliƒüi
            const cleanName = name.replace(/[^a-zA-Z0-9]/g, ""); 
            const url = `https://www.dreamlo.com/lb/${PRIVATE_CODE}/add/${cleanName}/${score}`;
            try {
                await fetch(url);
                getScores('end'); // Kaydettikten sonra listeyi g√ºncelle
            } catch (e) { console.log("Hata:", e); }
        }

        async function getScores(target) {
            const url = `https://www.dreamlo.com/lb/${PUBLIC_CODE}/json`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                let list = [];

                if(data.dreamlo.leaderboard === null) {
                    list = [];
                } else if (Array.isArray(data.dreamlo.leaderboard.entry)) {
                    list = data.dreamlo.leaderboard.entry;
                } else {
                    list = [data.dreamlo.leaderboard.entry];
                }
                
                updateUI(list, target);
            } catch (e) { 
                console.log("Veri √ßekme hatasƒ±:", e); 
                document.getElementById(target === 'start' ? 'lb-list-start' : 'lb-list-end').innerText = "Hen√ºz kimse oynamadƒ±.";
            }
        }

        function updateUI(list, target) {
            const el = document.getElementById(target === 'start' ? 'lb-list-start' : 'lb-list-end');
            el.innerHTML = "";
            
            list.slice(0, 10).forEach((item, index) => {
                let color = '#fff';
                if(index === 0) color = '#ffd700'; 
                if(index === 1) color = '#c0c0c0'; 
                if(index === 2) color = '#cd7f32'; 
                
                el.innerHTML += `
                    <div class="lb-row" style="color:${color}">
                        <span class="lb-rank">#${index+1}</span>
                        <span class="lb-name">${item.name}</span>
                        <span class="lb-score">${item.score}</span>
                    </div>
                `;
            });
        }

        // --- OYUN MOTORU ---
        
        const player = {x:0, y:0, trail:[], dashing:false};
        let enemies=[], orbs=[], particles=[];

        function resize(){ w=c.width=window.innerWidth; h=c.height=window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        function startGame() {
            const val = document.getElementById('nickInput').value;
            if(!val) return alert("L√ºtfen bir isim yaz!");
            nickname = val;
            document.getElementById('displayNick').innerText = nickname.toUpperCase();

            document.getElementById('screens').style.display = 'none';
            document.getElementById('end-view').style.display = 'none';
            document.getElementById('ui-layer').style.display = 'block';
            
            gameActive = true; score = 0; player.x=w/2; player.y=h/2;
            enemies=[]; orbs=[]; player.trail=[];
            loop();
        }

        function triggerDash() {
            if(!gameActive) return;
            player.dashing = true;
            for(let i=0; i<10; i++) particles.push({x:player.x, y:player.y, vx:(Math.random()-0.5)*15, vy:(Math.random()-0.5)*15, life:1, color:'#00f2ff'});
            setTimeout(() => player.dashing = false, 250);
        }
        
        const dashBtn = document.getElementById('dash-btn');
        dashBtn.addEventListener('touchstart', (e)=>{e.preventDefault(); triggerDash();});
        dashBtn.addEventListener('mousedown', (e)=>{e.preventDefault(); triggerDash();});

        function gameOver() {
            gameActive = false;
            document.getElementById('ui-layer').style.display = 'none';
            document.getElementById('screens').style.display = 'flex';
            document.getElementById('login-view').style.display = 'none';
            document.getElementById('end-view').style.display = 'flex';
            document.getElementById('finalScore').innerText = score;
            
            document.getElementById('lb-list-end').innerHTML = '<div class="loading">Skor g√∂nderiliyor...</div>';
            sendScore(nickname, score);
        }

        function loop() {
            if(!gameActive) return;
            requestAnimationFrame(loop);
            
            ctx.fillStyle = 'rgba(5,5,8,0.25)'; ctx.fillRect(0,0,w,h);
            
            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.04)'; ctx.lineWidth=1; ctx.beginPath();
            for(let i=0; i<w; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,h); }
            for(let i=0; i<h; i+=50) { ctx.moveTo(0,i); ctx.lineTo(w,i); }
            ctx.stroke();

            // Oyuncu Hareketi
            player.x += (targetX - player.x) * 0.15;
            player.y += (targetY - player.y) * 0.15;
            
            player.trail.push({x:player.x, y:player.y});
            if(player.trail.length > 15) player.trail.shift();

            // Oyuncu √áizim
            ctx.beginPath();
            ctx.strokeStyle = player.dashing ? '#fff' : '#00f2ff';
            ctx.lineWidth = player.dashing ? 8 : 4;
            ctx.lineCap = 'round';
            if(player.trail.length) { ctx.moveTo(player.trail[0].x, player.trail[0].y); for(let p of player.trail) ctx.lineTo(p.x, p.y); }
            ctx.stroke();
            
            ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(player.x, player.y, 8, 0, Math.PI*2); ctx.fill();

            // Puanlar
            if(Math.random()<0.05) orbs.push({x:Math.random()*w, y:Math.random()*h});
            orbs.forEach((o,i) => {
                ctx.fillStyle='#0f0'; ctx.shadowBlur=10; ctx.shadowColor='#0f0';
                ctx.beginPath(); ctx.arc(o.x, o.y, 6, 0, Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
                if(Math.hypot(player.x-o.x, player.y-o.y)<25) {
                    score += 10; document.getElementById('scoreVal').innerText = score; orbs.splice(i,1);
                }
            });

            // D√º≈ümanlar
            if(Math.random()<0.04) enemies.push({x:Math.random()*w, y:-30, vx:(Math.random()-0.5)*3, vy:Math.random()*4+3});
            enemies.forEach((e,i) => {
                e.x += e.vx; e.y += e.vy;
                ctx.fillStyle='#ff0055'; ctx.shadowBlur=15; ctx.shadowColor='#ff0055'; 
                ctx.beginPath(); ctx.arc(e.x, e.y, 12, 0, Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
                
                if(!player.dashing && Math.hypot(player.x-e.x, player.y-e.y)<20) gameOver();
                if(e.y > h) enemies.splice(i,1);
            });
            
            // Par√ßacƒ±klar (Efektler)
            particles.forEach((p,i) => {
                p.x+=p.vx; p.y+=p.vy; p.life-=0.05;
                ctx.fillStyle=p.color; ctx.globalAlpha=p.life; ctx.beginPath(); ctx.arc(p.x,p.y,3,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
                if(p.life<=0) particles.splice(i,1);
            });
        }

        let targetX=w/2, targetY=h/2;
        window.addEventListener('touchmove', e=>{e.preventDefault(); targetX=e.touches[0].clientX; targetY=e.touches[0].clientY;}, {passive:false});
        window.addEventListener('mousemove', e=>{targetX=e.clientX; targetY=e.clientY;});

        // Ba≈ülangƒ±√ßta listeyi y√ºkle
        getScores('start');

    </script>
</body>
</html>

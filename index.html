<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON FLUX: INFINITY</title>
    <style>
        body {
            margin: 0;
            background-color: #050505;
            overflow: hidden;
            touch-action: none; /* Kaydırmayı engelle */
            font-family: 'Segoe UI', sans-serif;
        }
        canvas { display: block; }
        #ui {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            pointer-events: none;
            mix-blend-mode: exclusion; /* Renklerin üstünde şık dursun */
            z-index: 10;
        }
        h1 {
            font-size: 4vw;
            margin: 0;
            letter-spacing: 10px;
            text-transform: uppercase;
            font-weight: 100;
            border-bottom: 1px solid white;
            padding-bottom: 10px;
        }
        p { font-size: 14px; margin-top: 15px; opacity: 0.7; letter-spacing: 2px; }
        #score-disp {
            position: absolute;
            top: 30px; left: 30px;
            color: rgba(255,255,255,0.8);
            font-size: 24px;
            font-weight: 100;
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body>

    <div id="score-disp">0</div>
    
    <div id="ui">
        <h1>NEON FLUX</h1>
        <p>BAŞLAMAK İÇİN DOKUN</p>
    </div>

    <canvas id="c"></canvas>

    <script>
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        const ui = document.getElementById('ui');
        const scoreEl = document.getElementById('score-disp');

        let w, h;
        let gameActive = false;
        let score = 0;
        let frame = 0;
        let timeScale = 1.0; // Slow motion için
        
        // Renk Değişkeni (HUE)
        let hue = 0;

        const player = { x: 0, y: 0, r: 8, trail: [] };
        let enemies = [];
        let particles = [];
        let orbs = []; // Toplanabilir puanlar
        let gridOffset = { x: 0, y: 0 }; // Grid hareketi için

        function resize() {
            w = c.width = window.innerWidth;
            h = c.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- YARDIMCI FONKSİYONLAR ---
        function random(min, max) { return Math.random() * (max - min) + min; }
        
        function createExplosion(x, y, color, count) {
            for(let i=0; i<count; i++){
                particles.push({
                    x: x, y: y,
                    vx: Math.cos(random(0, Math.PI*2)) * random(2, 8),
                    vy: Math.sin(random(0, Math.PI*2)) * random(2, 8),
                    life: 1.0,
                    color: color,
                    size: random(2, 5)
                });
            }
        }

        // --- OYUN DÖNGÜSÜ ---
        function loop() {
            requestAnimationFrame(loop);
            
            // Renk döngüsü
            hue = (hue + 0.5) % 360;
            const mainColor = `hsl(${hue}, 100%, 60%)`;

            // Arkaplan Temizliği (İz Efekti İçin Hafif Opak)
            ctx.fillStyle = `rgba(5, 5, 5, ${0.3 * timeScale})`; 
            ctx.fillRect(0, 0, w, h);

            // --- 1. GRID (IZGARA) EFEKTİ ---
            // Grid oyuncunun tersine hareket ederek derinlik hissi verir
            ctx.strokeStyle = `rgba(255, 255, 255, 0.05)`;
            ctx.lineWidth = 1;
            const gridSize = 50;
            
            // Grid kaydırma hesabı
            const offX = (player.x * 0.05) % gridSize;
            const offY = (player.y * 0.05) % gridSize;

            ctx.beginPath();
            // Dikey Çizgiler
            for (let x = -gridSize; x < w + gridSize; x += gridSize) {
                ctx.moveTo(x - offX, 0);
                ctx.lineTo(x - offX, h);
            }
            // Yatay Çizgiler
            for (let y = -gridSize; y < h + gridSize; y += gridSize) {
                ctx.moveTo(0, y - offY);
                ctx.lineTo(w, y - offY);
            }
            ctx.stroke();


            // --- 2. OYUNCU ---
            if (gameActive || particles.length > 0) {
                // Kuyruk (Trail)
                player.trail.push({x: player.x, y: player.y});
                if (player.trail.length > 15) player.trail.shift();

                // Kuyruk Çizimi
                if (gameActive) {
                    ctx.beginPath();
                    ctx.strokeStyle = mainColor;
                    ctx.lineWidth = 4;
                    ctx.lineCap = 'round';
                    // Bezier curve ile daha yumuşak çizgi
                    ctx.moveTo(player.trail[0].x, player.trail[0].y);
                    for (let i = 1; i < player.trail.length; i++) {
                        const p = player.trail[i];
                        ctx.lineTo(p.x, p.y);
                    }
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = mainColor;
                    ctx.stroke();
                    ctx.shadowBlur = 0;

                    // Oyuncu Merkezi
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
                    ctx.fill();
                }
            }

            // --- 3. ORBS (PUANLAR) ---
            if (gameActive && frame % 30 === 0) {
                orbs.push({
                    x: random(0, w), y: random(0, h),
                    r: 5, active: true
                });
            }

            for (let i = orbs.length - 1; i >= 0; i--) {
                let o = orbs[i];
                
                // Manyetik Çekim Efekti
                let dx = player.x - o.x;
                let dy = player.y - o.y;
                let dist = Math.hypot(dx, dy);

                if (dist < 150) { // Yakınsa çek
                    o.x += dx * 0.05;
                    o.y += dy * 0.05;
                }

                // Çizim
                ctx.fillStyle = mainColor;
                ctx.shadowBlur = 10;
                ctx.shadowColor = mainColor;
                ctx.beginPath(); ctx.arc(o.x, o.y, o.r, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 0;

                // Toplama
                if (dist < player.r + o.r + 10) {
                    score += 10;
                    scoreEl.innerText = score;
                    orbs.splice(i, 1);
                    // Toplama efekti (küçük patlama)
                    createExplosion(o.x, o.y, mainColor, 3);
                }
            }

            // --- 4. DÜŞMANLAR (KARANLIK MADDE) ---
            if (gameActive && frame % 40 === 0) {
                // Ekranın kenarından gelsin
                let angle = random(0, Math.PI*2);
                let radius = Math.max(w, h) / 1.5;
                enemies.push({
                    x: w/2 + Math.cos(angle) * radius,
                    y: h/2 + Math.sin(angle) * radius,
                    vx: -Math.cos(angle) * (2 + score/500), // Merkeze değil, rastgele aksın
                    vy: -Math.sin(angle) * (2 + score/500),
                    r: random(10, 20),
                    angle: angle // Kendi ekseninde dönmesi için
                });
            }

            for (let i = enemies.length - 1; i >= 0; i--) {
                let e = enemies[i];
                // Oyuncuyu hafif takip etsin (Zorluk)
                let dx = player.x - e.x;
                let dy = player.y - e.y;
                let angleToPlayer = Math.atan2(dy, dx);
                
                e.vx += Math.cos(angleToPlayer) * 0.05;
                e.vy += Math.sin(angleToPlayer) * 0.05;
                
                // Hız sınırlama (timeScale ile çarpılır - Slow motion için)
                e.x += e.vx * timeScale;
                e.y += e.vy * timeScale;

                // Düşman Çizimi (Dikenli Yapı)
                ctx.save();
                ctx.translate(e.x, e.y);
                ctx.rotate(frame * 0.05); // Dönme efekti
                ctx.fillStyle = '#ff0044';
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ff0000';
                ctx.beginPath();
                // Kare çiz ama dönüyor
                ctx.rect(-e.r, -e.r, e.r*2, e.r*2);
                ctx.fill();
                // İçine siyah delik
                ctx.fillStyle = '#000';
                ctx.beginPath(); ctx.arc(0, 0, e.r/2, 0, Math.PI*2); ctx.fill();
                ctx.restore();

                // Çarpışma (ÖLÜM)
                let dist = Math.hypot(player.x - e.x, player.y - e.y);
                if (gameActive && dist < player.r + e.r) {
                    gameOver();
                }

                // Ekrandan çok uzaklaşırsa sil
                if (e.x < -w || e.x > w*2 || e.y < -h || e.y > h*2) enemies.splice(i, 1);
            }

            // --- 5. PARÇACIKLAR (PATLAMALAR) ---
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx * timeScale;
                p.y += p.vy * timeScale;
                p.life -= 0.02 * timeScale; // Slow motionda yavaş sön
                p.size *= 0.95;

                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fill();
                ctx.globalAlpha = 1.0;

                if (p.life <= 0) particles.splice(i, 1);
            }

            frame++;
        }

        // --- KONTROLLER ---
        function startGame(e) {
            if (gameActive) return;
            
            // Reset
            gameActive = true;
            score = 0;
            scoreEl.innerText = "0";
            enemies = [];
            orbs = [];
            particles = [];
            player.trail = [];
            timeScale = 1.0; // Hızı normale döndür
            
            // UI Gizle
            ui.style.display = 'none';
            scoreEl.style.display = 'block';

            // Başlangıç pozisyonu (parmak/mouse yeri)
            movePlayer(e);
        }

        function gameOver() {
            gameActive = false;
            
            // SLOW MOTION DEATH EFFECT
            timeScale = 0.1; // Her şeyi yavaşlat
            
            // Büyük patlama
            createExplosion(player.x, player.y, '#fff', 50);
            createExplosion(player.x, player.y, '#ff0044', 30);

            // UI Göster (Biraz gecikmeli)
            setTimeout(() => {
                ui.style.display = 'block';
                ui.innerHTML = `<h1>YOK OLDUN</h1><p>SKOR: ${score}</p><p style="color:#ff0044; font-weight:bold">TEKRAR DOKUN</p>`;
            }, 1000);
        }

        function movePlayer(e) {
            if (!gameActive && timeScale === 1.0) return; // Oyun bitmişse ve slow motion bitmemişse hareket etme
            e.preventDefault();
            
            let cx, cy;
            if(e.touches) {
                cx = e.touches[0].clientX;
                cy = e.touches[0].clientY;
            } else {
                cx = e.clientX;
                cy = e.clientY;
            }

            // Yumuşak takip (Lerp)
            // Eğer çok yavaşlatılmışsa (ölüm anı) hareket etmesin
            if (timeScale > 0.5) {
                player.x += (cx - player.x) * 0.3; // 0.3 = Daha sıkı kontrol
                player.y += (cy - player.y) * 0.3;
            }
        }

        // Event Listeners
        window.addEventListener('mousedown', startGame);
        window.addEventListener('touchstart', startGame, {passive: false});
        
        window.addEventListener('mousemove', movePlayer);
        window.addEventListener('touchmove', movePlayer, {passive: false});

        // Başlat
        loop();

    </script>
</body>
</html>
